# Тест-кейсы: Проверка сохранения данных в БД

| ID | Название | Описание | Шаги | Ожидаемый результат | Связанный тест |
|----|---------|----------|------|---------------------|----------------|
| TC-DB-001 | Успешный платёж сохраняется в БД | Проверить, что при успешной оплате данные сохраняются в `payment_entity` и `order_entity` | 1. Открыть страницу<br>2. Выбрать кнопку "Купить" или "Купить в кредит"<br>3. Заполнить форму валидными данными<br>4. Нажать "Продолжить"<br>5. Дождаться "Операция одобрена Банком"<br>6. Проверить БД | - В `payment_entity` (или `credit_request_entity`) есть запись со статусом `APPROVED`<br>- В `order_entity` есть запись, ссылающаяся на `transaction_id` или `bank_id` | test_db_ui_payment_approved_stored |
| TC-DB-002 | Отклонённый платёж сохраняется в БД | Проверить, что при отклонённом платеже данные сохраняются со статусом `DECLINED` | 1. Открыть страницу<br>2. Выбрать кнопку<br>3. Заполнить номер карты "4444 4444 4444 4442"<br>4. Нажать "Продолжить"<br>5. Дождаться "Ошибка! Банк отказал..."<br>6. Проверить БД | - В `payment_entity` или `credit_request_entity` есть запись со статусом `DECLINED`<br>- В `order_entity` есть связанный заказ | test_db_ui_payment_declined_stored |
| TC-DB-003 | ID операций уникальны | Проверить, что при двух успешных платежах генерируются разные `transaction_id` / `bank_id` | 1. Выполнить два успешных платежа подряд<br>2. Получить `transaction_id` или `bank_id` обоих операций из БД<br>3. Сравнить их | - `transaction_id` / `bank_id` различаются<br>- Нет дубликатов | test_db_ui_transaction_id_unique |
| TC-DB-004 | Время создания записи корректно | Проверить, что поле `created` в БД заполнено корректно | 1. Выполнить успешный платёж<br>2. Получить запись из БД<br>3. Проверить поле `created` | - `created` — объект `datetime`<br>- Не в будущем<br>- Отличается от текущего времени не более чем на 60 секунд | test_db_ui_created_timestamp_correct |
| TC-DB-005 | Проверка связи заказа и платежа | Убедиться, что `order_entity` ссылается на существующий платёж или кредит | 1. Выполнить успешный платёж<br>2. Получить `payment_id` или `credit_id` из `order_entity`<br>3. Проверить существование записи в `payment_entity` или `credit_request_entity` | - `payment_id` / `credit_id` не `NULL`<br>- Связанная запись существует в соответствующей таблице | test_db_order_payment_link_exists |




