# План автоматизации тестирования веб‑сервиса покупки тура


## 1. Перечень автоматизируемых сценариев


### Позитивные сценарии
- **Покупка тура за полную стоимость (дебетовая карта)**:
  - ввод корректных данных карты;
  - успешная оплата через Payment Gate;
  - отображение статуса успешного платежа;
  - сохранение записи в БД (*ID: присвоен системой, Сумма : «45 000», Дата и время: «присвоен системой», статус: «APPROVED», ID транзакции: «присвоен системой»*).

- **Оформление кредита на тур**:
  - ввод корректных данных карты;
  - одобрение кредита через Credit Gate;
  - отображение статуса успешной заявки;
  - сохранение записи в БД (*ID: присвоен системой, Сумма : «45 000», Дата и время: «присвоен системой», статус: «APPROVED», ID транзакции: «присвоен системой»*).

### Негативные сценарии
- **Ошибка оплаты** (некорректные данные):
  - имитация отказа от Payment Gate;
  - отображение ошибки пользователю;
  - запись в БД (*ID: присвоен системой, Сумма : «45 000», Дата и время: «присвоен системой», статус: «DECLINED», ID транзакции: «присвоен системой»*).


- **Отказ в кредите**:
  - имитация отказа от Credit Gate;
  - уведомление пользователя;
  - запись в БД (*ID: присвоен системой, Сумма : «45 000», Дата и время: «присвоен системой», статус: «DECLINED», ID транзакции: «присвоен системой»*).


- **Пустые/некорректные поля формы**  
- проверка валидации на каждой странице (клиентская и серверная валидация);  
- тестирование граничных значений;  
- проверка сообщений об ошибках для каждого поля.

Для **каждого поля ввода** на всех страницах интерфейса тестируются следующие сценарии:


### Поля платёжной формы и сценарии их проверки


**Перечень полей:**
- Номер карты;
- Месяц (срок действия);
- Год (срок действия);
- Владелец (имя держателя);
- CVC/CVV.


#### Номер карты


**Позитивные сценарии:**
- ввод корректного номера (16 цифр);
- автоформатирование при вводе (разделение на группы по 4 цифры);
- сохранение маскированного отображения, показ только последних 4 цифр (безопасность ввода).


**Негативные сценарии:**
- пустое поле → сообщение «Поле обязательно для заполнения»;
- менее 16 цифр → «Неверный формат номера карты»;
- более 16 цифр → «Неверный формат номера карты»;
- буквы/спецсимволы → «Допускаются только цифры»;


#### Месяц (срок действия)


**Позитивные сценарии:**
- ввод от `01` до `12` → принятие значения.


**Негативные сценарии:**
- пустое поле → «Поле обязательно для заполнения»;
- `00` → «Неверно указан срок действия карты»;
- `13` и более → «Неверно указан срок действия карты»;
- буквы/спецсимволы → «Допускаются только цифры»;
- одна цифра (`1`–`9`) → «Неверный формат ввода».


#### Год (срок действия)

**Позитивные сценарии:**
- ввод текущего года и будущих (например, `24`, `25`, `30`) → принятие значения.


**Негативные сценарии:**
- пустое поле → «Поле обязательно для заполнения»;
- прошлый год (например, `23` при текущем `24`) → «Карта просрочена»;
- четыре цифры (`2024`) → «Неверный формат»;
- буквы/спецсимволы → «Допускаются только цифры»;
- значение `00` → «Неверный год».


#### Владелец (имя держателя)


**Позитивные сценарии:**
- латинские буквы, пробелы, дефисы (например, `IVAN IVANOV`) → принятие значения.


**Негативные сценарии:**
- пустое поле → «Поле обязательно для заполнения»;
- кириллица → «Используйте латинские буквы»;
- цифры → «Недопустимые символы»;
- спецсимволы (`!@#$%` и т.п.) → «Недопустимые символы»;
- более 26 символов → «Превышено допустимое количество символов»;
- только пробелы → «Поле не может состоять из пробелов».


#### CVC/CVV


**Позитивные сценарии:**
- ввод 3 цифр → принятие значения.


**Негативные сценарии:**
- пустое поле → «Поле обязательно для заполнения»;
- 1–2 цифры → «Введите 3 цифры»;
- 4 и более цифр → «Введите 3 цифры»;
- буквы/спецсимволы → «Допускаются только цифры»;
- пробелы → «Допускаются только цифры».



### Интеграционные сценарии
- Проверка взаимодействия с Payment Gate (HTTP‑запросы, коды ответов).
- Проверка взаимодействия с Credit Gate (аналогично).
- Синхронизация статусов платежа между приложением и БД.


## 2. Перечень используемых инструментов

1. **Selenium WebDriver + Python**  
   *Обоснование*: поддержка кросс‑браузерного тестирования, богатая экосистема Python для автоматизации, простота интеграции с pytest.

2. **Pytest**  
   *Обоснование*: современный фреймворк для Python, поддержка параметризованных тестов, удобные фикстуры, подробная отчётность.

3. **Allure Report**  
   *Обоснование*: наглядные отчёты с шагами, скриншотами, историей прогонов; есть интеграция с pytest.

4. **Requests**  
   *Обоснование*: тестирование API платёжных шлюзов, имитация ответов, проверка JSON/HTTP‑кодов.

5. **Docker**  
   *Обоснование*: изоляция тестовой среды (БД, моки шлюзов), воспроизводимость тестов.

6. **Git**  
   *Обоснование*: версионирование тестов, CI/CD‑интеграция.

7. **MySQL**  
    *Обоснование*: продукционная СУБД приложения; используется в тестовом окружении через Docker для валидации сохранения данных.

8. **DBeaver**  
    *Обоснование:*  
    - универсальный SQL‑клиент с поддержкой множества СУБД;  
    - визуальный конструктор запросов;  
    - экспорт данных в разных форматах;  
    - анализ производительности;  
    - удобная работа с большими объёмами данных.

9. **SQLAlchemy**  
   *Обоснование*: удобное взаимодействие с БД в тестах, миграция тестовых данных, совместимость с MySQL.

## 3. Перечень и описание рисков

1. **Изменение API платёжных шлюзов**  
   - *Риск*: тесты падают из‑за обновлённых параметров.  
   - *Митигация*: регулярное обновление моков, мониторинг документации API.

2. **Нестабильность тестовой БД**  
   - *Риск*: конфликты данных между тестами.  
   - *Митигация*: использование Docker‑контейнера с чистой БД для каждого прогона.


3. **Локальные зависимости (браузеры, драйверы)**  
   - *Риск*: несовместимость версий на разных машинах.  
   - *Митигация*: Docker + Selenium Grid, фиксация версий в `pom.xml`.


4. **Ложные срабатывания из‑за задержек шлюзов**  
   - *Риск*: тайм‑ауты при ожидании ответа.  
   - *Митигация*: явные ожидания (`WebDriverWait`), увеличение таймаутов в тестах.


5. **Нарушение безопасности при тестировании**  
   - *Риск*: случайное сохранение тестовых данных карт.  
   - *Митигация*: использование тестовых окружений шлюзов, проверка логов на наличие PAN.


## 4. Интервальная оценка (в часах)


| Этап | Описание | Оценка (ч) |
|------|--------|------------|
| 1 | Анализ требований и составление тест‑кейсов | 15         |
| 2 | Настройка тестового окружения (Docker, MySQL, зависимости) | 10         |
| 4 | Написание UI‑тестов (Selenium + pytest) | 35         |
| 5 | Написание API‑тестов (Requests) | 17         |
| 6 | Написание тестов для БД (SQLAlchemy + проверка через HeidiSQL) | 8          |
| 7 | Интеграция с Allure, настройка отчётов | 6          |
| 8 | Отладка и стабилизация тестов | 20         |
| 9 | Прогон тестов, анализ результатов | 4          |
| 10 | Документирование (Plan.md, README) | 6          |
| **Итого** | | **121**    |

## 5. План сдачи работ


| Этап | Срок | Результат                                                                     |
|------|------|-------------------------------------------------------------------------------|
| Подготовка окружения и моков | Неделя 1 | Docker‑конфигурации, работающие моки шлюзов, образ MySQL с тестовой схемой    |
| Разработка UI‑ и API‑тестов | Неделя 2–3 | Разработка тестов покрывающие наибольшее количество сценариев (pytest‑модули) |
| Разработка тестов БД | Неделя 3 | Проверки сохранения/чтения данных, валидация схемы                            |
| Интеграция с Allure | Неделя 4 | Отчёты в формате HTML, доступные в репозитории                                |
| Первый полный прогон | Неделя 4 | Протодокол результатов (pass/fail), список дефектов, скриншоты из HeidiSQL    |
| Финальная проверка и документирование | Неделя 5 | Plan.md, обновлённый README, архив отчётов, SQL‑дампы тестовых данных         |
| Передача в эксплуатацию | Неделя 5 | Инструкция по запуску тестов, доступ к HeidiSQL‑конфигурации                  |


## 6. Отчёт по автоматизации


**Формат**: Markdown‑файл (`Plan.md`) в корне репозитория.  
**Содержание**:  
- актуальный статус автоматизации (покрытые сценарии, пробелы);
- ссылки на отчёты Allure (в виде архива или хоста);
- список известных проблем и путей их решения;
- инструкции по запуску тестов;
- файл `requirements.txt` с зависимостями;
- SQL‑скрипты для развёртывания тестовой БД;
- скриншоты проверок через HeidiSQL (опционально).
